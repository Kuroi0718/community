<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">
<head>
<meta charset="UTF-8">
<title>商品</title>
 <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
 <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<style>
.title{
font-size:30px;
font-weight:bold;
}
.text{
font-size:25px;
}
.square2,.square{
border:1px grey solid;
background-color:#D8D8EB;
}
.square2:hover,.square:hover{
transform:scale(1.05);
}
.square2:active,.square:active{
transform:scale(1);
}
.square{
width:40px;
height:40px;
}
.square{
border-radius:0.375rem;
}
</style>
</head>
<body style="overflow:hidden;background-color:#EAE0D5">
<div th:replace="~{mall/nav}"></div>
<div id="EEEE" style="filter:blur(5px);position:absolute;z-index:-2;width:100vw;">
<div  style="height:88vh;width:100vw;overflow-y:scroll" >
<!-------------------------------商品Start ---------------------------------------------->
<!-------------**************************分享*************************-------------------->
				<div  id="shareProduct" style="position:absolute;z-index:3;background-color:pink;width:420px;height:400px;left:40%;display:none;overflow-y:scroll;padding-bottom:50px;padding-top:50px">
					<figure>
					<input type="checkbox" style="width:50px;height: 80px;position:absolute;margin-left:50px" value="Id">
					<div id="share" style="width: 200px; height: 80px; margin: auto;margin-top:20px;border: 1px solid silver;background-color:#F2EFE9;">
					<div style="position:absolute;margin-top:30px;margin-left:30px">name</div>
					<img src="../image/noimg.png"  style="width:70px;float:right;margin:5px">
					</div>
					</figure>
					<div style="display: flex; flex-direction: row">
					<button id="closeShareButton" style="width:90px; height: 50px; margin-left:100px;margin-top:20px;" onclick="closeShareProduct()">取消</button>
					<button style="width:90px; height:50px; margin-left:20px;margin-top:20px;">分享</button>
					</div>
					<input id="shareContent" value=""></input>
				</div>
<!----------------------------------CARD --------------------------------------->
			<th:block th:switch="${product != null}" >
				<div th:case="${true}" style="display:flex;flex-direction:row">

						<div class="card" style="width: 50rem;height: 50rem;margin:auto;border:1px solid silver;background-color:#F2EFE9;margin-top:30px;font-weight:bold">
							<div  style="max-width: 30rem;height: 30rem;overflow:hidden;margin:auto;margin-top:30px;margin-bottom:30px;border:1px solid silver;border-radius:0.375rem;">
							<img th:src="@{'/mall/showPhoto?productId=' + ${product.productId}}"
								style="max-width: 30rem;height: 30rem;" >
							</div>
							<div class="" style="width: 40rem;margin:auto;margin-bottom:30px">
								<p class="card-title"><span class="title">商品名稱:</span><span class="text">[[${product.productName}]]</span></p>
								<p class="card-text" >
									<span class="title">價錢:</span><span class="text">[[${product.price}]]</span><br>
									<span class="title">數量:</span><span class="text">[[${product.quantity}]]</span><br>
									<span class="title">商品描述:</span><br><span class="text">[[${product.info}]]</span><br>
									
								</p>
									
								<div
									style="display: flex; flex-direction: row;max-width: 40rem;float:right">
									<th:block th:switch="${session.loggedInMember != null}">
										<div th:case="${true}" style="display: flex; flex-direction: row">
											
													<button class="square"
														th:onclick="addToMyLikes([[${product.productId}]])">
														<img th:class="${product.productId}" th:src="@{'/mall/showLike?productId=' + ${product.productId}}">
													</button>
													<button class="square" th:onclick="findMyFriendList([[${product.productId}]])">
														<img th:src="@{/image/arrow.png}">
													</button>
													<form th:id="${product.productId}"
														th:action="@{/mall/addToMyCart}"
														enctype="multipart/form-data" method="post">
														<label for="amount" style="padding-right: 15px"></label>買
														<input type="number" id="amount" name="amount" step=1
															min=0 max=999999 value="1" style="width: 4vw; height: 3vh"></input>個
														<input type="hidden" id="myCartProductId"
															name="myCartProductId" th:value="${product.productId}"></input>
														<button type="button"
															th:onclick="addToMyCart([[${product.productId}]])"
															style="height: 40px; border-radius: 0.375rem;font-weight:bold" class="square2">加入購物車</button>
													</form>
													
										</div>
										<div th:case="${false}">
													
													<button disabled class="square">
														<img th:src="@{/image/heart0.png}">
													</button>
													<button disabled class="square">
														<img th:src="@{/image/arrow.png}">
													</button>
											<button disabled
														style="height: 40px; border-radius: 0.375rem;font-weight:bold" class="square2">加入購物車</button>
										</div>
										
								</div>
							</div>
						</div>

				</div>
				
				
				
			</th:block>


<!----------------------------------CARD --------------------------------------->
<div style="margin:auto;align-items:center;width: 50rem;margin-top:30px;">
<button id="QButton" onclick="showQuestionBlock()" style="width: 150px;height:50px;border-top-left-radius:0.375rem;border-top-right-radius:0.375rem;border:1px solid grey;border-bottom:none;font-weight:bold;font-size:20px">問與答</button>
<button id="RButton" onclick="showRatingBlock()" style="width: 150px;height:50px;border-top-left-radius:0.375rem;border-top-right-radius:0.375rem;border:1px solid grey;border-bottom:none;font-weight:bold;font-size:20px">評價</button>
</div>
<!----------------------------------tab--------------------------------------->
<div style="margin:auto;align-items:center;width: 50rem;margin-bottom:50px">

 <!----------------------------------Q&A-------->
		<div id="QandABlock" style="width: 50rem;margin:auto;border:1px solid silver;background-color:#F2EFE9;border-radius:0.375rem;display:inline-flex;
		flex-direction:column ;padding-left:5rem;padding-bottom:50px;border-top-left-radius:0;display:block">
 		
 				<form id="askForm" th:action="@{/mall/productQuestion}" enctype="multipart/form-data" method="post" style="display:flex;flex-direction:row;margin-bottom:3rem;margin-top:3rem;">
				<input type="hidden" name="productId" th:value="${product.productId}"></input>
				<textarea id="content" rows="3" name="content" placeholder="請輸入商品問題......"
					style="width: 35rem; height: 5vh; resize: none;border-radius:0.375rem;line-height:4vh"></textarea>
				<button type="button" style="width: 5rem;height: 5vh;display:flex;line-height:5vh;border-radius:0.375rem;font-weight:bold" class="square2" th:onclick="ask()">提交問題</button>
 				</form>
 
<!-----------------------------問題們----->
	<div style="width:40rem">
	<th:block th:switch="${questionList != null}">
		<div th:case="${true}">
			<div id="myQ" style="display:flex;flex-direction:column-reverse;margin-bottom:-24px"></div>
			<th:block th:each="q : ${questionList}">
			<br>
			<div style="display:flex;flex-direction:row" >
				<div class="QuestionCard" style="width: 40rem;height:8rem;overflow:hidden;border:1px solid grey;background-color:white">
					<div style="display:flex;flex-direction:row">
						<div style="width: 4rem; height: 4rem; overflow: hidden">
							<img src="../image/question.png" style="width: 4rem; height: 4rem;">
						</div>
						<div style="display:flex;flex-direction:column">
							<div class="card-body" style="padding:20px" >
								<p class="card-text">問題:[[${q.content}]]</p>
								<small class="text-muted">提問者:<img th:src="@{'/mall/showMemberPhoto?id=' + ${q.askerId}}"
								style="width: 2rem; height: 2rem;">發問時間:[[${q.askDate}]]</small>
							</div>
						</div>
					</div>
				</div>
				
				</div>
		<th:block th:switch="${q.answer != ''}">
		<div th:case="${true}">
				<div style="display:flex;flex-direction:row" >
				<div class="answerCard" style="width: 40rem;height:8rem;margin-bottom:20px;overflow:hidden;border:1px solid grey;background-color:white;border-top:none">
					<div style="display:flex;flex-direction:row">
					<div style="width: 4rem; height: 4rem; overflow: hidden">
							<img src="../image/answer.png" style="width: 4rem; height: 4rem;">
								
						</div>
						<div style="display:flex;flex-direction:column">
							<div class="card-body" style="padding:20px" >
								<p class="card-text">回答:[[${q.answer}]]</p>
								<p class="card-text"><small class="text-muted">回應時間:[[${q.answerDate}]]</small></p>
							</div>
						</div>
					</div>
				</div>
				</div>
				</div>
				</th:block>
			</div>
		</th:block>
	</div>
<!-----------------------------問題們----->

		</div>
 	 
<!-----------------------------------Q&A-------->
<!----------------------------------Rating----->
  	
		<div id="ratingBlock" style="width: 50rem;display:flex;flex:inline-flex;margin:auto;border:1px solid silver;background-color:#F2EFE9;border-radius:0.375rem;border-top-left-radius:0;display:none">
			<th:block th:if="${commentList.size() == 0}">
			<div class="card" style="width: 40rem;height:10rem;margin:auto;margin-top:20px;background-color:#F2EFE9;margin-bottom:20px;border-radius:0.375rem;overflow:hidden;border:none;text-align:center;padding-top:3rem;font-size:30px">尚無評價</div>
			</th:block>
							<th:block th:if="${commentList != null}">
							<th:block th:each="c : ${commentList}">
			<div class="card" style="width: 40rem;height:10rem;margin:auto;margin-top:20px;margin-bottom:20px;border-radius:0.375rem;overflow:hidden;border:1px solid grey;">
							
						
						<div style="display:flex;flex-direction:column;">
							<div class="card-body">
								<span class="card-title">買家評價</span>
								<th:block th:if="${c.score == 5}">
								<img src="../image/rating1.png" width="25px" >
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								</th:block>
								<th:block th:if="${c.score == 4}">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								</th:block>
								<th:block th:if="${c.score == 3}">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								</th:block>
								<th:block th:if="${c.score == 2}">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								</th:block>
								<th:block th:if="${c.score == 1}">
								<img src="../image/rating1.png" width="25px" style="margin-left:1.1px">
								</th:block>
								<p class="card-text">評語：[[${c.content}]]</p>
								<p class="card-text">
									<small class="text-muted">日期：[[${c.getCommentDateString()}]]</small>
								</p>
							</div>
							
							
						</div>
					
				</div>
							</th:block>
							</th:block>
			
		</div>
  	
<!----------------------------------Rating------>

</div>
<!----------------------------------tab--------------------------------------->
<!-------------------------------商品End ---------------------------------------------->
<!-----right--buttons--------------------------->			
	<a th:href="@{/}"><button style="width:50px;height:50px;border-radius:0.375rem;background-color:#BDB4BF;position:fixed;right:35px;bottom:30px;background-image:url('../image/home.png');background-repeat:no-repeat;background-position:center;border:grey 1px solid"></button></a>
	<a th:href="@{/mall/mePage}"><button style="width:50px;height:50px;border-radius:0.375rem;background-color:#BDB4BF;position:fixed;right:35px;bottom:90px;background-image:url('../image/envelope.png');background-repeat:no-repeat;background-position:center;border:grey 1px solid"></button></a>
	<a th:href="@{/mall/mePage}"><button style="width:50px;height:50px;border-radius:0.375rem;background-color:#BDB4BF;position:fixed;right:35px;bottom:150px;background-image:url('../image/cart.png');background-repeat:no-repeat;background-position:center;border:grey 1px solid"></button></a>
	<a href="#top"><button style="width:50px;height:50px;border-radius:0.375rem;background-color:#BDB4BF;position:fixed;right:35px;bottom:210px;background-image:url('../image/up.png');background-repeat:no-repeat;background-position:center;border:grey 1px solid"></button></a>
	
	<th:block th:switch="${session.loggedInMember != null}">
	<div id="cartNum" th:case="${true}" style="display:none;width:25px;height:25px;border-radius:25px;background-color:red;position:fixed;right:25px;bottom:185px;z-index:1;text-align:center;color:#EAE0D5;font-weight:bold">[[${num}]]</div>
	</th:block>	
<!-----right--buttons--------------------------->
</div>
</div>
<script>
function closeShareProduct(){
let shareProduct = document.getElementById('shareProduct');
shareProduct.style.display='none';
}
</script>
<script>
let shareProduct = document.getElementById('shareProduct');
function findMyFriendList(pid){
let xhttp = new XMLHttpRequest();
xhttp.onload = function(){
shareProduct.innerHTML = xhttp.responseText;
shareProduct.style.display='block';
}
xhttp.open("POST","http://localhost:8080/community/mall/findMyFriendList",true);
xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xhttp.send("productId="+pid);
}
</script>
<script>
function sendShareList() {
let shareProductId = document.getElementById('shareProductId');
let checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
checkboxes.forEach(function(checkbox){
console.log(checkbox.value);
shareList(checkbox.value,'<a href="/community/mall/productPage?productId='+shareProductId.value+'">看看這個!!</a>');
})
let shareProduct = document.getElementById('shareProduct');
shareProduct.style.display='none';
}

function shareList(mid,content) {
let formdata = new FormData();
formdata.append('target',mid);
formdata.append('content',content);
	let xhrForm = new XMLHttpRequest();
	xhrForm.onload = function() {
		let websocketMessage = {
			id: myId.value,
			target: mid,
			type: 1
		};
		websocket.send(JSON.stringify(websocketMessage));
		appendMessage(0, messageInput.value.trim(), xhrForm.responseText, "self");
		messageInput.value = "";
		messageInput.focus();
		part.value = "";
	}
	xhrForm.open("POST", "/community/message/shareMessage", true);
	xhrForm.send(formdata);
}
</script>
<script>

function showRatingBlock(){
let QandABlock = document.getElementById("QandABlock")
let ratingBlock = document.getElementById("ratingBlock")
QandABlock.style.display='none';
ratingBlock.style.display='block';
}
function showQuestionBlock(){
let QandABlock = document.getElementById("QandABlock")
let ratingBlock = document.getElementById("ratingBlock")
ratingBlock.style.display='none';
QandABlock.style.display='block';
}

</script>
<script>
let count = 0;
function ask(){
count = count+1;
let content = document.getElementById("content")
let form = document.getElementById("askForm");
let formdata = new FormData(form);
let xhttp = new XMLHttpRequest();
xhttp.onload = function(){
content.value="";
let Q = document.createElement("div");
Q.innerHTML = xhttp.responseText;
let outer = document.createElement("div");
outer.style.marginBottom = '22px';
outer.setAttribute("id","outer_"+count);
document.getElementById("myQ").appendChild(outer);
document.getElementById("outer_"+count).appendChild(Q);
}
xhttp.open("POST","http://localhost:8080/community/mall/productQuestion",true);
xhttp.send(formdata);

}
</script>
<script>
let cartNum = document.getElementById("cartNum")
if(cartNum.innerHTML!=0){
cartNum.style.display='block';
}

function addToMyCart(pid){
let form = document.getElementById(pid);
let formdata = new FormData(form);
let xhttp = new XMLHttpRequest();
xhttp.onload = function(){
cartNum.style.display='block';
cartNum.innerHTML = xhttp.responseText;
}
xhttp.open("POST","http://localhost:8080/community/mall/addToMyCart",true);
xhttp.send(formdata);
}
</script>
	<script>
function addToMyRecord(pid){
console.log(pid);
let xhttp = new XMLHttpRequest();
xhttp.open("POST","http://localhost:8080/community/mall/addToMyRecord",true);
xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xhttp.send("productId="+pid);
}
</script>
	<script>
function addToMyLikes(pid){
let img = document.getElementsByClassName(pid)[0];
console.log(pid);
let xhttp = new XMLHttpRequest();
xhttp.onload = function(){
let str = xhttp.responseText;
if(str==='0'){
	img.src='/community/image/heart.png';
}else{
	img.src='/community/image/heart0.png';
}
}
xhttp.open("POST","http://localhost:8080/community/mall/addToMyLikes",true);
xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xhttp.send("productId="+pid);
}
</script>
<script>
function type(chosen){
var category = document.getElementById("category");
var xhttp = new XMLHttpRequest();
xhttp.onload = function(){
document.getElementById("typeDetail").innerHTML = xhttp.responseText;
}
xhttp.open("POST","http://localhost:8080/community/mall/typeDetail",true);
xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xhttp.send("type="+chosen);
}
</script>

<script>
function showDetail(chosen){
var category = document.getElementById("category");
var xhttp = new XMLHttpRequest();
xhttp.onload = function(){
document.getElementById("detail").innerHTML = xhttp.responseText;
}
xhttp.open("POST","http://localhost:8080/community/mall/categoryDetail",true);
xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xhttp.send("category="+chosen);
}
</script>
<script>
let all = document.getElementById('EEEE');
 all.addEventListener("mouseover",function(){
        all.style.filter = "none";
 })
 div1.addEventListener("mouseover",function(){
        all.style.filter = "blur(5px)";
 })
 div2.addEventListener("mouseover",function(){
        all.style.filter = "blur(5px)";
 })
</script>

</body>
</html>