<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<div th:replace="~{layout/navbar}"></div>
	
			<nav aria-label="Page navigation example">
			<ul class="pagination">
				<th:block th:switch="${page.number > 0 }">
					<li class="page-item" th:case=${true}><a class="page-link"
						th:href="@{/member/page?(p=${page.number})}">上一頁</a></li>
					<li class="page-item" th:case=${false}><span class="page-link">上一頁</span></li>
				</th:block>
					<li class="page-item"><a class="page-link"
						onclick="gM()">上5頁</a></li>
				<th:block
					th:each=" groupNumber : ${#numbers.sequence(1,page.totalPages/5+1)} ">
					<div th:id="${groupNumber}" class="pagination">
					<th:block
						th:each=" pageNumber : ${#numbers.sequence(5*groupNumber-4,5*groupNumber)} ">
						<th:block th:switch="${ pageNumber <= page.totalPages }">
						<span th:case=${true}>
						<th:block  th:switch="${ page.number != pageNumber -1 }">
							<li class="page-item" th:case=${true}><a class="page-link"
								th:href="@{/member/page?(p=${pageNumber})}">[[${pageNumber}]]</a></li>
							<li class="page-item" th:case=${false}><span
								class="page-link">[[${pageNumber}]]</span></li>
						</th:block>
						</span>
						</th:block>
					</th:block>
					</div>
				</th:block>
				<li class="page-item"><a class="page-link"
						onclick="gP()">下5頁</a></li>
				<th:block th:switch="${page.number+1 < page.totalPages }">
					<li class="page-item" th:case=${true}><a class="page-link"
						th:href="@{/member/page?(p=${page.number+2})}">下一頁</a></li>
					<li class="page-item" th:case=${false}><span class="page-link">下一頁</span></li>
				</th:block>
				<li class="page-item"><input style="width:70px" type="number" th:value="${ page.number +1 }" id="pageInput" onkeyup="range()" onchange="range()"></input>
				<button id="pageButton" onclick="goTo()">前往</button>
				</li>
			</ul>
		</nav>
	
	
	<table>
		<thead>
			<tr>
			    <td>ID</td>
				<td>大頭貼</td>
				<td>帳號</td>
				<td>權限</td>
			</tr>
		</thead>
		
		<tbody>
			<th:block th:each=" aMember : ${page.content} ">
			
				<tr>
				    <td th:text="${aMember} ? ${aMember.id}"> </td>
					<td>
    		           <th:block th:switch="${aMember.photo.length != 0 }">
                           <img th:case=${true} id="photo" style="width:50px" th:src="@{'data:image/*;base64,'+${aMember.generateBase64Image()}}" />
                           <img th:case=${false}  style="width:50px" th:src="@{/image/noimg.png}" />
                       </th:block>
                   </td>
					<td th:text="${aMember} ? ${aMember.username}"> </td>
					    
					         <th:block  th:switch="${aMember.level == 'admin' }">
					         <td  th:case=${true}>
					         <select th:value="${aMember.level}">
                             <option >admin</option>
 						     </select>
 						     </td>
 						     <td  th:case=${false}>
 						     
 						     <th:block th:switch="${aMember.level}">
 						     <select  th:case="member" th:id="${aMember.id}" onchange="levels(this.id)">
 						      <option value="member" selected="selected">member</option>
 						     <option value="disable">disable</option>
 						     <option value="muted">muted</option>
 						     </select>

 						 	 <select  th:case="disable" th:id="${aMember.id}" onchange="levels(this.id)">
 						      <option value="member">member</option>
 						     <option value="disable" selected="selected">disable</option>
 						     <option value="muted">muted</option>
 						     </select>   
 						     
 						      <select  th:case="muted" th:id="${aMember.id}" onchange="levels(this.id)">
 						      <option value="member">member</option>
 						     <option value="disable">disable</option>
 						     <option value="muted" selected="selected">muted</option>
 						     </select>  
 						     
 						     </th:block>
 						     
 						     </td>
 						     </th:block>
					   
					 
				</tr>
				</th:block>
		</tbody>
	</table>
	<input type="hidden" id="var1" th:value="${page.totalPages/5+1}"></input>
	<input type="hidden" id="var2" th:value="${page.totalPages}"></input>

	
	
	
</body>

<script type="text/javascript">
	
	function showupdate(){
	if(document.getElementById("show").style.display==="none"){document.getElementById("send").style.display="none";document.getElementById("show").style.display="block";document.getElementById("edit").innerHTML="編輯";}else{document.getElementById("send").style.display="none";document.getElementById("show").style.display="none";document.getElementById("edit").innerHTML="取消編輯";document.getElementById("send").style.display="block";}
	if(document.getElementById("update").style.display==="none"){document.getElementById("update").style.display="block";document.getElementById("edit").innerHTML="取消編輯";}else{document.getElementById("update").style.display="none";document.getElementById("edit").innerHTML="編輯";}
	}
	
		function sendForm() {
			var form = document.getElementById("form1");
			var formdata = new FormData(form);
			var xhr = new XMLHttpRequest();
			xhr.onload = function() {
				document.getElementById("msg").innerHTML = xhr.responseText;
				refreshSession();
			}

			xhr.open("POST", "http://localhost:8080/community/member/update", true);
			xhr.send(formdata);
		}
		
		function refreshSession(){
		var xhr1 = new XMLHttpRequest();
		xhr1.onload = function() {
		document.getElementById("member").innerHTML = xhr1.responseText;
		}
		xhr1.open("POST", "http://localhost:8080/community/member/refreshLogin", true);
		xhr1.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		xhr1.send("id="+idnumber.value);
		}
	
	
		function check(){
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (xhttp.readyState == 4 && xhttp.status == 200)
				document.getElementById("checkUsername").innerHTML = xhttp.responseText;
		}
		xhttp.open("POST","http://localhost:8080/community/member/ajax/checkUsername",true);
		xhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		xhttp.send("username="+updatename.value);
		}
		
		
		function levels(id){
		var xhr2 = new XMLHttpRequest();
		xhr2.open("POST","http://localhost:8080/community/member/ajax/changeLevel",true);
		xhr2.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		xhr2.send("id="+id+"&level="+document.getElementById(id).value);
		}
		
		
		var pages= document.getElementById("var1").value;
		var totalPages= document.getElementById("var2").value;
		var g=3;
		
		console.log(pages);
		function showGroup(){
		for(let i=1;i<=pages;i++){
		document.getElementById(i).style.display='none';
		}
		document.getElementById(g).style.display='';
		}
		
		showGroup();
		function gP(){
		if(g<pages)
		g++;
		showGroup();
		}
		function gM(){
		if(g>1)
		g--;
		showGroup();
		}
		
		function goTo(){
		window.location.href = "http://localhost:8080/community/member/page?p="+pageInput.value;
		}
		
		function range(){
		if(pageInput.value<1){
		pageInput.value=1;
		}
		if(pageInput.value>totalPages){
		pageInput.value=totalPages;
		}
		}
	</script>

</html>